---
version: '3.8'
services:
  React:
    build:
      context: ./
      dockerfile: Dockerfile.react
      target: base
    container_name: react
    image: "react-todo"
    depends_on:
      - Nodejs
    ports:
      - target: 3000
        published: ${DD_PORT:-3000}
        protocol: tcp
        mode: host
  Nodejs:
    build:
      context: ./
      dockerfile: Dockerfile.nodejs
      target: base
    container_name: nodejs
    image: "nodejs-todo"
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      DD_DATABASE_USER: ${DD_DATABASE_USER}
      DD_DATABASE_HOST: ${DD_DATABASE_HOST}
      DD_DATABASE_PASSWORD: ${DD_DATABASE_PASSWORD}
      DD_DATABASE_DIALECT: ${DD_DATABASE_DIALECT}
    links:
      - mysql
  mysql:
    image: mysql:5.7.37@sha256:66d52e6baa8093820c09fec56992a5ee734f17e9fad8ef5ffc31597b231bd048
    container_name: mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_USER: ${DD_DATABASE_USER}
      MYSQL_PASSWORD: ${DD_DATABASE_PASSWORD}
      DD_DATABASE_DIALECT: ${DD_DATABASE_DIALECT}
    command:
      [
        'mysqld',
        '--character-set-server=utf8mb4',
        '--collation-server=utf8mb4_unicode_ci'
      ]
